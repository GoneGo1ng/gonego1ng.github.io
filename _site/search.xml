<?xml version="1.0" encoding="utf-8"?>
<search>
  
    <entry>
      <title><![CDATA[å…³äºŽ RocketMQ å¤šå®žä¾‹æ¶ˆè´¹è€…çš„ä¸€ä¸ªé—®é¢˜]]></title>
      <url>/rocketmq/2022/08/24/%E5%85%B3%E4%BA%8E-RocketMQ-%E5%A4%9A%E5%AE%9E%E4%BE%8B%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="text"><![CDATA[å‰è¨€ä»Šå¤©åœ¨å’Œé¢†å¯¼è®¨è®ºå…³äºŽ RocketMQ çš„ä½¿ç”¨è§„èŒƒæ—¶ï¼Œæˆ‘æå‡ºæˆ‘ä»¬å›¢é˜Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°äº†å¤šä¸ªå®žä¾‹çš„æ¶ˆè´¹è€…åˆ† tags æ¶ˆè´¹åŒä¸€ä¸ª topicã€‚é¢†å¯¼æ•é”åœ°å¯Ÿè§‰åˆ°è¿™ç§ç”¨æ³•åœ¨é›†ç¾¤çŽ¯å¢ƒä¸‹ä½¿ç”¨å¾ˆå¯èƒ½æœ‰é—®é¢˜ï¼Œè®©æˆ‘éªŒè¯ä¸€ä¸‹ã€‚éªŒè¯Consumer çš„ä»£ç å¦‚ä¸‹ï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šèµ·äº†ä¸¤ä¸ªè¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼‰ï¼ŒåŽŸæœ¬ä»¥ä¸ºä¼šå‡è¡¡çš„è´Ÿè½½åˆ°è¿™ä¸¤ä¸ªæ¶ˆè´¹è€…ä¸Šé¢ã€‚ä½†æ˜¯ç»“æžœå¹¶ä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä¸€å…±å‘é€äº†åæ¡æ¶ˆæ¯ï¼Œè¿™ä¸¤ä¸ªå¹¶æ²¡æœ‰æ”¶åˆ°å…¨éƒ¨åæ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¶åˆ°çš„æ¶ˆæ¯å…¨éƒ½ç›¸åŒã€‚è¿™ä¸ªç»“æžœä¹Ÿè¯å®žäº†é¢†å¯¼æå‡ºçš„ç–‘é—®ã€‚@RocketMQMessageListener(        topic = "${demo.rocketmq.topic}",        consumerGroup = "taga-consumer-group",        selectorExpression = "${demo.rocketmq.tagA}")public class TagAConsumer implements RocketMQListener&lt;String&gt;, RocketMQPushConsumerLifecycleListener {    @Override    public void onMessage(String message) {        System.out.printf("------- TagAConsumer received: %s \n", message);    }    @Override    public void prepareStart(DefaultMQPushConsumer consumer) {        // è®¾ç½®å½“å‰å®žä¾‹çš„åç§°        // consumer.setInstanceName("tag-a-consumer-instance@" + UtilAll.getPid());        consumer.setInstanceName("tag-a-consumer-instance");    }}åˆ†æžå¸¦ç€ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯¹ RocketMQ æºç è¿›è¡Œäº†ç®€å•åˆ†æžã€‚æŸ¥çœ‹ä¸‹é¢ä¸¤æ®µæºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ° RocketMQ é»˜è®¤çš„å¹³å‡è´Ÿè½½ç­–ç•¥æ˜¯æ ¹æ® clientId åŽ»åˆ†é…çš„ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ª clientId åˆæ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Œæˆ‘ä»¬æŽ¥ç€å¾€ä¸‹çœ‹ã€‚RebalanceImpl.java...        AllocateMessageQueueStrategy strategy = this.allocateMessageQueueStrategy;List&lt;MessageQueue&gt; allocateResult = null;try {    allocateResult = strategy.allocate(        this.consumerGroup,        this.mQClientFactory.getClientId(), // å…ˆçœ‹è¿™é‡Œ        mqAll,        cidAll);} catch (Throwable e) {    log.error("allocate message queue exception. strategy name: {}, ex: {}", strategy.getName(), e);    return false;}...AllocateMessageQueueAveragelyï¼šå¹³å‡è´Ÿè½½ç­–ç•¥ï¼ŒRocketMQ é»˜è®¤ä½¿ç”¨çš„ç­–ç•¥ã€‚AllocateMessageQueueAveragely.javapackage org.apache.rocketmq.client.consumer.rebalance;import java.util.ArrayList;import java.util.List;import org.apache.rocketmq.client.log.ClientLogger;import org.apache.rocketmq.logging.InternalLogger;import org.apache.rocketmq.common.message.MessageQueue;/** * Average Hashing queue algorithm */public class AllocateMessageQueueAveragely extends AbstractAllocateMessageQueueStrategy {    public AllocateMessageQueueAveragely() {        log = ClientLogger.getLog();    }    public AllocateMessageQueueAveragely(InternalLogger log) {        this.log = log;    }    @Override    public List&lt;MessageQueue&gt; allocate(String consumerGroup, String currentCID, List&lt;MessageQueue&gt; mqAll,        List&lt;String&gt; cidAll) {        List&lt;MessageQueue&gt; result = new ArrayList&lt;MessageQueue&gt;();        if (!check(consumerGroup, currentCID, mqAll, cidAll)) {            return result;        }        // å†çœ‹è¿™é‡Œ        int index = cidAll.indexOf(currentCID);        int mod = mqAll.size() % cidAll.size();        int averageSize =            mqAll.size() &lt;= cidAll.size() ? 1 : (mod &gt; 0 &amp;&amp; index &lt; mod ? mqAll.size() / cidAll.size()                + 1 : mqAll.size() / cidAll.size());        int startIndex = (mod &gt; 0 &amp;&amp; index &lt; mod) ? index * averageSize : index * averageSize + mod;        int range = Math.min(averageSize, mqAll.size() - startIndex);        for (int i = 0; i &lt; range; i++) {            result.add(mqAll.get((startIndex + i) % mqAll.size()));        }        return result;    }    @Override    public String getName() {        return "AVG";    }}ä»Žä¸‹é¢è¿™æ®µæºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œå¦‚æžœæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå›ºå®šå€¼çš„ instanceNameï¼Œé‚£ä¹ˆç”Ÿæˆçš„ clientId çš„æ ¼å¼æ˜¯è¿™æ ·çš„ IP@instanceNameï¼Œå½“åŒä¸€ä¸ªæœåŠ¡å™¨ä¸ŠåŒæ—¶èµ·äº†ä¸¤ä¸ªæœåŠ¡ï¼ˆéžå®¹å™¨ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæœåŠ¡çš„ IP æ˜¯ç›¸åŒçš„ï¼ŒinstanceName ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ clientId ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚å†æ ¹æ®ä¸Šé¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä»£ç ï¼Œæˆ‘ä»¬å°±ä¸éš¾çœ‹å‡ºä¸ºä»€ä¹ˆä¼šå‡ºçŽ°æˆ‘å‰é¢éªŒè¯çš„é‚£ä¸ªé—®é¢˜äº†ã€‚ClientConfig.java...public String buildMQClientId() {    StringBuilder sb = new StringBuilder();    sb.append(this.getClientIP());    sb.append("@");    sb.append(this.getInstanceName());    if (!UtilAll.isBlank(this.unitName)) {    sb.append("@");    sb.append(this.unitName);    }    return sb.toString();}...public void changeInstanceNameToPID() {    if (this.instanceName.equals("DEFAULT")) {    this.instanceName = String.valueOf(UtilAll.getPid());    }}...  å¦‚æžœæƒ³è¦è¿›ä¸€æ­¥åˆ†æž RocketMQ çš„æºç ï¼Œå¯ä»¥å‚è€ƒè¿™ä½å¤§ä½¬å†™çš„è¿™ç¯‡æ–‡ç« ï¼šRocketmqæºç åˆ†æž12ï¼šconsumer è´Ÿè½½å‡è¡¡ç»“è®ºä¸Šé¢çš„é—®é¢˜ä¸€èˆ¬åªä¼šå‡ºçŽ°åœ¨ä¸ä½¿ç”¨å®¹å™¨éƒ¨ç½²çš„é›†ç¾¤çŽ¯å¢ƒä¸‹ï¼ˆè€Œä¸”æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼‰ï¼Œæˆ‘ä»¬ç”Ÿäº§çŽ¯å¢ƒä¸€èˆ¬éƒ½æ˜¯ k8sï¼ˆcluster ipï¼‰ ä¹Ÿå°±æ˜¯è¯´ Consumer èµ·æ¥çš„æ—¶å€™æ‹¿åˆ°çš„ IP æ˜¯å®¹å™¨çš„ IPï¼Œä¸å¤ªä¼šå‡ºçŽ°ä¸Šé¢çš„é—®é¢˜ã€‚ä½†å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æ³¨æ„ï¼Œå»ºè®®åœ¨è®¾ç½® instanceName çš„æ—¶å€™åŽé¢åŠ ä¸€ä¸ªéšæœºæ•°ã€‚å†™åœ¨æœ€åŽðŸ˜ æ°”æ­»ï¼Œç¿»äº†ç¿» Git ä¸Š RocketMQ æœ€æ–°çš„æºç ï¼Œå‘çŽ°äººå®¶ RocketMQ æ—©å°±å·²ç»æŠŠè¿™ä¸ª BUG ä¿®å¤äº†ï¼Œæˆ‘è¿˜åœ¨è¿™é‡Œç”¨è€ç‰ˆæœ¬ï¼ˆrocketmq-client:4.8.0ï¼‰çš„ä»£ç åˆ†æžäº†åŠå¤©ï¼Œæ°”æ­»äº†ï¼ClientConfig.java...public String buildMQClientId() {    StringBuilder sb = new StringBuilder();    sb.append(this.getClientIP());    sb.append("@");    sb.append(this.getInstanceName());    if (!UtilAll.isBlank(this.unitName)) {        sb.append("@");        sb.append(this.unitName);    }    if (enableStreamRequestType) {        sb.append("@");        sb.append(RequestType.STREAM);    }    return sb.toString();}...public void changeInstanceNameToPID() {    if (this.instanceName.equals("DEFAULT")) {    this.instanceName = UtilAll.getPid() + "#" + System.nanoTime();    }}...]]></content>
      <categories>
        
          <category> RocketMQ </category>
        
      </categories>
      <tags>
        
          <tag> RocketMQ </tag>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[å¦‚ä½•ä½¿ç”¨ GitHub Pages æ­å»ºè‡ªå·±çš„ Blog]]></title>
      <url>/blog/2022/08/20/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-GitHub-Pages-%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84-Blog/</url>
      <content type="text"><![CDATA[å…³äºŽæ­å»º Blogï¼Œä¸‹é¢è¿™ç¯‡æ–‡ç« å·²ç»ä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†äº†ï¼Œä½†æ˜¯æˆ‘åœ¨æŒ‰ç…§ä»–çš„æ­¥éª¤æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›å‘ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚  å‚è€ƒï¼šä½¿ç”¨GitHubæ­å»ºè‡ªå·±çš„Blogæ­å»º Blogè¿™éƒ¨åˆ†å‚è€ƒæ–‡ç« çš„æ­¥éª¤æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå¹¶ä¸”å‚è€ƒæ–‡ç« å†™çš„æ›´åŠ è¯¦ç»†ï¼Œå»ºè®®æ ¹æ®å‚è€ƒæ–‡ç« æ­å»ºã€‚æˆ‘æŠŠè¿™éƒ¨åˆ†åŠ è¿›æ¥ï¼Œä¸»è¦æ˜¯æƒ³æµ‹è¯•ä¸€ä¸‹å›¾ç‰‡çš„åŠŸèƒ½ã€‚æ–°å»º Repositoryå¡«å†™ Repository nameè®¾ç½® GitHub Pagesé€‰æ‹©ä¸»é¢˜æäº¤ä»£ç æŸ¥çœ‹ BlogåŒæ­¥ä»£ç é€‰æ‹©ç¼–è¾‘å™¨è¿™éƒ¨åˆ†å‚è€ƒæ–‡ç« æ²¡æœ‰è¯´æ˜Žä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç¼–è¾‘å™¨ï¼Œæˆ‘è¿™è¾¹ç›´æŽ¥ç”¨çš„æ˜¯ IntelliJ IDEAã€‚ä½¿ç”¨ IDEA åŒæ­¥ GitHub ä»£ç è¿™ä¸€æ­¥å°±ä¸å¤šè¯´ï¼Œåº”è¯¥éƒ½ä¼šçš„å§ã€‚å®‰è£… NexTâš ï¸ è­¦å‘Šï¼è­¦å‘Šï¼å‰æ–¹å¤§é‡è¸©å‘ï¼Œä¸æ„¿æ„æŠ˜è…¾çš„åŒå­¦å¯ä»¥è¶æ—©æ”¾å¼ƒäº†ã€‚ä¹Ÿå¯èƒ½æ˜¯æˆ‘çŽ¯å¢ƒçš„é—®é¢˜ï¼Œå¸Œæœ›ä½ ä»¬åœ¨æ“ä½œçš„æ—¶å€™ä¸€åˆ‡é¡ºåˆ©ã€‚  å‚è€ƒï¼šNexT å®˜æ–¹ä½¿ç”¨æ–‡æ¡£æ­£å¸¸æ¥è¯´ï¼Œå®‰è£… NexT åªéœ€è¦å‡ åˆ†é’Ÿå°±å¯ä»¥äº†ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘é‡åˆ°äº†å¾ˆå¤šå‘ï¼Œå¯¼è‡´æˆ‘æžäº†ä¸¤ä¸ªåŠå¤©æ‰æžå®šã€‚ä¸‹é¢è®°å½•ä¸€ä¸‹ï¼šå‘ä¸€å®‰è£…ä¾èµ–ï¼šbundle install è¿™ä¸€æ­¥æŠ¥ä¸‹é¢è¿™ä¸ªé”™ï¼šAn error occurred while installing commonmarker (0.17.13), and Bundler cannot continue.è§£å†³æ–¹æ³•ï¼š  é‡è£… Homebrewï¼Œæ²¡æœ‰è§£å†³é—®é¢˜  é‡è£… Rubyï¼Œé‡è£…ä¹‹åŽå‘çŽ°ç”¨ Homebrew å®‰è£…çš„ Ruby ç‰ˆæœ¬ï¼ˆ3.1.xï¼‰å’Œ Mac è‡ªå¸¦çš„ Ruby ç‰ˆæœ¬ï¼ˆ2.6.xï¼‰ä¸ä¸€è‡´ï¼Œåˆæ”¹çŽ¯å¢ƒå˜é‡æŠŠ Ruby æ”¹åˆ° Homebrew å®‰è£…çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œä½†ä¹Ÿæ²¡æœ‰è§£å†³é—®é¢˜  åˆ é™¤ Gemfile.lock æ–‡ä»¶ï¼Œé‡æ–°æ‰§è¡Œ bundle install å‘½ä»¤ï¼Œæ“ä½œå®ŒæˆåŽæ¢äº†ä¸€ä¸ªé”™è¯¯ï¼šAn error occurred while installing unf_ext (0.0.8.2), and Bundler cannot continue.  æ‰§è¡Œ xcode-select --install å‘½ä»¤ï¼Œå®‰è£… xcode-select åŽï¼Œå†æ‰§è¡Œ bundle install å‘½ä»¤ï¼Œæ‰§è¡ŒæˆåŠŸ ðŸŽ‰ðŸŽ‰ðŸŽ‰å‘äºŒè¿è¡Œ Jekyllï¼šbundle exec jekyll server è¿™ä¸€æ­¥æŠ¥ä¸‹é¢è¿™ä¸ªé”™ï¼šbundler: failed to load command: jekyll (/usr/local/bin/jekyll)è§£å†³æ–¹æ³•ï¼š  æ‰§è¡Œ jekyll --version å‘½ä»¤æŸ¥çœ‹ jekyll ç‰ˆæœ¬å·ï¼Œè¿”å›ž zsh: command not found: jekyll  æ‰§è¡Œ bundle info jekyll å‘½ä»¤ï¼Œè¿”å›ž jekyll ç‰ˆæœ¬å· * jekyll (3.9.2)  æŠ˜è…¾åˆ°è¿™é‡Œï¼Œæœ‰ç‚¹æ™•ä¹Žä¹Žçš„äº†ï¼Œè®°ä¸å¤ªæ¸…æ¥šåŽé¢åšäº†ä»€ä¹ˆæ“ä½œ  æ ¹æ®è¿™ä½å¤§ä½¬çš„æ–¹æ³•ï¼Œæ‰§è¡Œäº† bundle add webrickï¼Œå†è¿è¡Œ Jekyllï¼Œç»ˆäºŽæˆåŠŸäº† ðŸŽ‰ðŸŽ‰ðŸŽ‰https://talk.jekyllrb.com/t/load-error-cannot-load-such-file-webrick/5417/5ä¸»è¦å°±ä»¥ä¸Šä¸¤ä¸ªå¤§å‘ï¼Œè§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­è¿˜é‡åˆ°äº†æ— æ•°å°å‘ï¼Œç²¾åŠ›æœ‰é™ï¼Œæ²¡æœ‰æ·±è¿½è¿™äº›é—®é¢˜çš„åŽŸå› ï¼Œè€Œä¸”æ˜¯éš”äº†ä¸€å¤©å†è®°å½•çš„ï¼Œå¾ˆå¤šç»†èŠ‚å·²ç»å¿˜è®°äº†ï¼Œå¸Œæœ›è¿™äº›æ¨¡ç³Šçš„è®°å¿†å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚Blog ä¸»é¢˜é…ç½®  NexT å®˜æ–¹æ–‡æ¡£å·²ç»åˆè¯¦ç»†çš„è¯´æ˜Žäº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼šä¸»é¢˜é…ç½®å†™åšå®¢ç”¨æ‰‹ï¼ˆå…¶ä»–éƒ¨ä½ä¹Ÿå¯ä»¥ï¼‰å†™ã€‚å†™çš„è¿‡ç¨‹ä¸­ï¼Œå‘çŽ°äº†ä¸€ä¸ªè¯¯ä»¥ä¸ºæ˜¯ BUG çš„åŠŸèƒ½ã€‚å¦‚æžœæ–‡ä»¶å¼€å¤´çš„ date å±žæ€§ä¸­å¡«çš„æ—¶é—´å¤§äºŽæœåŠ¡å™¨æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« æ˜¯ä¸ä¼šåœ¨ Blog ä¸­æ˜¾ç¤ºçš„ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ NexT è®¾è®¡çš„ä¸€ä¸ªå®šæ—¶å‘å¸ƒæ–‡ç« çš„åŠŸèƒ½ðŸ‘ã€‚æœ€åŽé™„ä¸Šä¸¤å¼ å¯çˆ±çŒ«çŒ«ç…§ðŸ±]]></content>
      <categories>
        
          <category> Blog </category>
        
      </categories>
      <tags>
        
          <tag> GitHub Pages </tag>
        
          <tag> Blog </tag>
        
      </tags>
      <tags></tags>
    </entry>
  
</search>
